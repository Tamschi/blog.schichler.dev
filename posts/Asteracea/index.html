<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"> <script defer="" data-domain="blog.schichler.dev" src="https://a.schichler.dev/js/script.js"></script><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Asteracea (as of right now) üåº" /><meta property="og:locale" content="en" /><meta name="description" content="This is a relatively high-level summary post of design decisions I made so far while implementing Asteracea and its related packages like the lignin group of crates. I‚Äôm making this post partially in response to Raph Levien‚Äôs Xilem: an architecture for UI in Rust, since I noticed we have largely similar approaches to app structure and lifecycle management (although we went for somewhat different solutions that are presented in superficially very different ways to the developer)." /><meta property="og:description" content="This is a relatively high-level summary post of design decisions I made so far while implementing Asteracea and its related packages like the lignin group of crates. I‚Äôm making this post partially in response to Raph Levien‚Äôs Xilem: an architecture for UI in Rust, since I noticed we have largely similar approaches to app structure and lifecycle management (although we went for somewhat different solutions that are presented in superficially very different ways to the developer)." /><link rel="canonical" href="https://blog.schichler.dev/posts/Asteracea/" /><meta property="og:url" content="https://blog.schichler.dev/posts/Asteracea/" /><meta property="og:site_name" content="Abstraction Haven" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-05-14T15:25:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Asteracea (as of right now) üåº" /><meta name="twitter:site" content="@tammeschichler" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"This is a relatively high-level summary post of design decisions I made so far while implementing Asteracea and its related packages like the lignin group of crates. I‚Äôm making this post partially in response to Raph Levien‚Äôs Xilem: an architecture for UI in Rust, since I noticed we have largely similar approaches to app structure and lifecycle management (although we went for somewhat different solutions that are presented in superficially very different ways to the developer).","url":"https://blog.schichler.dev/posts/Asteracea/","@type":"BlogPosting","headline":"Asteracea (as of right now) üåº","dateModified":"2022-05-19T18:08:06+02:00","datePublished":"2022-05-14T15:25:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.schichler.dev/posts/Asteracea/"},"@context":"https://schema.org"}</script><title>Asteracea (as of right now) üåº | Abstraction Haven</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Abstraction Haven"><meta name="application-name" content="Abstraction Haven"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/assets/un-cdn/jsdelivr/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="/assets/un-cdn/jsdelivr/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="/assets/un-cdn/jsdelivr/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/un-cdn/jsdelivr/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="/assets/un-cdn/jsdelivr/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div class="site-title mt-3"> <a href="/">Abstraction Haven</a></div><div class="site-subtitle font-italic">Mostly Rust, sometimes mainly carbohydrates.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://ko-fi.com/tamme/" aria-label="ko-fi" target="_blank" rel="noopener" title="https://ko-fi.com/tamme/" > <i class="fas fa-coffee"></i> </a> <a href="https://tamschi.itch.io/" aria-label="itch.io" target="_blank" rel="noopener" title="https://tamschi.itch.io/" > <i class="fab fa-itch-io"></i> </a> <a href="https://github.com/Tamschi" aria-label="github" target="_blank" rel="noopener" title="https://github.com/Tamschi" > <i class="fab fa-github"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['tamme','schichler.dev'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="xmpp:tamme@schichler.dev" aria-label="xmpp" > <i class="fas fa-comment-dots"></i> </a> <a href="https://nerdculture.de/@Tamschi" aria-label="mastodon" target="_blank" rel="noopener" title="https://nerdculture.de/@Tamschi" > <i class="fab fa-mastodon"></i> </a> <a href="https://twitter.com/tammeschichler" aria-label="twitter" target="_blank" rel="noopener" title="https://twitter.com/tammeschichler" > <i class="fab fa-twitter"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Asteracea (as of right now) üåº</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Asteracea (as of right now) üåº</h1><div class="post-meta text-muted"><div style="float: left; clear: left;"> By <em> <a href="https://schichler.dev/">Tamme Schichler</a> </em></div><div style="float: right; clear: right;"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/rust/'>Rust</a>, <a href='/categories/asteracea/'>Asteracea</a></div><div class="d-flex" style="float: left; clear: left;"><div> <span> Posted <em class="timeago" date="2022-05-14 15:25:00 +0200" data-toggle="tooltip" data-placement="bottom" title="Sat, May 14, 2022, 3:25 PM +0200" >May 14, 2022</em> </span> <span> Updated <em class="timeago" date="2022-05-19 18:08:06 +0200 " data-toggle="tooltip" data-placement="bottom" title="Thu, May 19, 2022, 6:08 PM +0200" >May 19, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="7163 words"> <em>39 min</em> read</span></div></div><div class="post-tags" style="float: right; clear: right;"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a> <a href="/tags/frontend/" class="post-tag no-text-decoration" >frontend</a> <a href="/tags/components/" class="post-tag no-text-decoration" >components</a> <a href="/tags/dsl/" class="post-tag no-text-decoration" >DSL</a></div><div style="clear: both;"></div></div><div class="post-content"><p>This is a relatively high-level summary post of design decisions I made so far while implementing <a href="https://github.com/Tamschi/Asteracea">Asteracea</a> and its related packages like the <code class="language-plaintext highlighter-rouge">lignin</code> group of crates. I‚Äôm making this post partially in response to <a href="https://raphlinus.github.io/rust/gui/2022/05/07/ui-architecture.html">Raph Levien‚Äôs Xilem: an architecture for UI in Rust</a>, since I noticed we have largely similar approaches to app structure and lifecycle management (although we went for somewhat different solutions that are presented in superficially very different ways to the developer).</p><p>Funnily enough, our architectures are both named after plant biology. I <a href="https://knockout.chat/thread/33201">previously explained</a> my choice as follows:</p><blockquote><p><strong>Why the name?</strong></p><p>I‚Äôd started naming my projects after plants shortly before starting this one.</p><p><a href="https://en.wikipedia.org/wiki/Asteraceae">Asteraceae</a> are often plain but wildly varied flowering plants. My wish with this project is to create a ‚Äúboring‚Äù system that is uninteresting by itself and highlights the user‚Äôs individuality.</p><p>The name also reflects that I‚Äôd like to support the creation of individual ‚Äúweb gardens‚Äù (small creative pages usually by individuals) as well as sustainable development of large enterprise apps (by encouraging maintainable code style through enterprise features like built-in dependency injection, as well as a green deployment due to (vastly) decreased runtime energy usage and hardware requirements).</p></blockquote><p>(My system uses mutable but largely non-moving data structures, so its supporting crates like <code class="language-plaintext highlighter-rouge">lignin</code> or <code class="language-plaintext highlighter-rouge">rhizome</code> tend to be named after <a href="https://en.wikipedia.org/w/index.php?title=Lignin&amp;oldid=1082275224">structural</a> <a href="https://en.wikipedia.org/wiki/Rhizome">components</a> rather than transport tissue, though.)</p><h2 id="a-word-of-caution">A Word of Caution<a href="#a-word-of-caution" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>First off, my professional background is largely web frontend development (about 1.5 years of specific experience?), and I don‚Äôt exactly have a formal education in this space. Similarly, I picked up English largely while teaching myself how to program. There may be rough patches in terms of vocabulary ahead, in either regard.</p><p>I‚Äôll also have to rely on examples and comparisons a bit more, since I lack the theoretical knowledge to name the different existing UI framework API patterns.</p><p>As such, please take everything here with a grain of salt, and feel free to point out issues. I‚Äôm used to harsh criticism and don‚Äôt mind as long as it attacks my ideas rather than something I have no control over.</p><h2 id="motivation">Motivation<a href="#motivation" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>I originally started work on Asteracea in late 2019, as part of a program I could host on my local network that would let me track itemised grocery bills and monitor individual product price changes. At the time, I also needed a break from JavaScript, but still decided to make it a website, so that I could use it easily on mobile without dealing with Android Studio.</p><p>Many of the choices I made and features I added are direct responses to frustrations I encountered while working as a consultant on web app projects, as well as as user of a fairly old computer, a phone with low system memory and frequently a slow internet connection.</p><p>I like websites that work also without JavaScript and don‚Äôt start with a loading screen, won‚Äôt unload other apps as soon as I browse to them, and don‚Äôt hog the CPU. As a developer, I prefer to work with very strongly typed languages and to have documentation available directly in the IDE, to reduce the amount of time I spend on a feature and the amount of context switches I have to do.</p><p>Additionally, and this is purely personal preference, I love small indie projects and also like crafting my own web presence in detail. (I have <em>not</em> gotten around to doing the latter, for the most part.)<br /> As such, I didn‚Äôt want to make a framework aimed <em>only</em> at larger scale deployments, but one that scales down nicely to even the smallest and simplest of pages and isn‚Äôt prescriptive in terms of document structure.</p><h2 id="goals">Goals<a href="#goals" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Asteracea is my attempt at making (web) frontend development both more convenient and more accessible, while raising the quality of the compiled applications.</p><p>The system is built from modular and often interchangeable parts, so while I‚Äôm working towards a turn-key bundle, you don‚Äôt <em>have</em> to use my macro DSL to make your components compatible with mine. This is also to enable incremental upgrades of the platform without spilling all application code along with it. (Some glue may be required between distinct paradigms, where there could be a mismatch in the API shape exposed by individual components.)</p><p>Personally, both boilerplate and syntactic noise irk me though, so I created a relatively concise macro transform that translates symbols and keywords into structural aspects of the component, while identifiers are mostly used only for application-level constructs.</p><h2 id="problems">Problems<a href="#problems" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>The main issue with implementing a classic model-view-controller pattern in Rust is that lifecycle management of stateful hierarchical GUIs <em>is a huge chore</em>, largely due to callbacks that have to reach deep into encapsulated components (while mutability of inert data is much less of a problem).</p><p>Component-instantiating GUI frameworks like Angular or WinForms tend to be very boilerplate-heavy, buying a straightforward mental model with dense syntax and/or restated structure. (WinForms gets around this with a designer and generated code, but that‚Äôs not a good option for web development, where a well-organised document structure often describes intent more than visual primitives.)<br /> Their strength is maintainable development at scale, as they hide transient local state very well and often allow for better code organisation than other paradigms.</p><p>Mainly reactive frameworks like eponymically React, which generate the GUI structure from only a render method, have greatly simplified syntax but often need workarounds for state management. React‚Äôs Hooks for example are very convenient, but they suffer from footguns related to control flow (that you can very reliably lint against, to be fair) and can‚Äôt entirely remove initialisation from their hot update path without potentially changing behaviour. They also tend to scale less-than-ideally to more complex applications, mostly hurting code organisation and maintainability.</p><p>WPF is overall well-designed and its basic features are very accessible due to great first-party tooling, but full use of its advanced features is not all that well communicated (with a large gap between consuming and providing them) and the framework is non-portable, which is stifling broader adoption.<br /> However, many of its systems rely on externally-visible fairly direct mutability of components, which doesn‚Äôt translate all that well into plain Rust. (.NET as a whole is not great at tree-shaking unused code due to its runtime metaprogramming features, but that‚Äôs not a problem with WPF in particular, just something that came up while I was thinking about how to make applications tiny enough for the clientside web.)</p><p>Immediate-mode GUIs like imgui or Unity‚Äôs editor GUI system have the advantage of being able to reuse language constructs like loops directly to model aspects of a hierarchical GUI (and save many of the nested parentheses you see in the structurally similar reactive ones, so their syntax tends to be cleaner and more open-ended), but they mostly suffer from very inconvenient state management for child components.</p><h2 id="my-approach">My Approach<a href="#my-approach" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>I‚Äôm remixing existing ideas (including from all of the above).</p><p>If you look at the individual pieces that make up Asteracea, you‚Äôll likely notice that nearly all of them already exist in some shape or form elsewhere.</p><p>This framework aims to be ‚Äúboring‚Äù:</p><ul><li>The macro DSL is mostly contextless and generates unspectacular code you could easily hand-write (if you didn‚Äôt mind <em>a lot</em> of verbosity and a bit of straightforward <code class="language-plaintext highlighter-rouge">unsafe</code> code for pin projections),<li>the procedural macro lowers syntactic sugar in steps (both by transforming and reparsing in terms of its own syntax, and by delegating to existing general-purpose macros in its output),<li>the generated HTML- and DOM-structure is no-frills as-if-handwritten, with no structural restrictions like mandatory custom elements and<li>there are no surprises that would suddenly lower app performance because you weren‚Äôt explicit enough.</ul><p>The one original concept that I didn‚Äôt see elsewhere before are <strong>interlaced local scopes</strong>, though I wouldn‚Äôt be surprised if that has been done elsewhere, as it‚Äôs a straightforward source code transformation.</p><p><a href="https://blog.schichler.dev/posts/Intrusive-Smart-Pointers-+-Heap-Only-Types-=/">Reference-counting through direct payload borrows</a> is something I came up with on a whim, but later learned already has <a href="https://en.cppreference.com/w/cpp/memory/enable_shared_from_this">standard library support</a> in C++ (although in a slightly different way that doesn‚Äôt mesh with strict provenance in Rust).</p><p>I‚Äôll annotate from where I lifted different concepts below each heading.</p><h2 id="my-solutions">My Solutions<a href="#my-solutions" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Everything explained here is implemented and functional (on some branch in the repository, but mostly indeed <em>develop</em>), unless otherwise noted. You‚Äôre invited to have a go at playing around with it, but keep in mind that there are some usability holes (and no standard library worth mentioning), and that some of the syntax is subject to change as I continue to simplify it.</p><p>There is a <a href="https://iter-square.zulipchat.com/#narrow/stream/303796-project.2FAsteracea">Zulip Stream</a> for this project, in case you have questions or would like to give feedback on this post.</p><p>Apologies for the outdated versions on Crates.io; I started work on larger changes a while back and haven‚Äôt finished polishing and documenting everything yet.</p><h3 id="interlaced-local-scopes-for-localised-semantics">Interlaced Local Scopes for Localised Semantics<a href="#interlaced-local-scopes-for-localised-semantics" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>The smallest, empty, component, which is a ZST, does not have inherent identity, does not incur allocations and does not generate output in either HTML or DOM, is roughly this:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nn">asteracea</span><span class="p">::</span><span class="nd">component!</span> <span class="p">{</span>
  <span class="nf">Empty</span><span class="p">()()</span>

  <span class="p">[]</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Which likely looks pretty odd. (Yes, that‚Äôs two parameter lists.)</p><p>I went with a use-what-you-need approach to reduce the boilerplate required for simple components. <strong>Stateful and pure reactive components are unified, with no baseline runtime overhead.</strong> There <em>are</em> some trade-offs in updating the DOM, as the underlying <code class="language-plaintext highlighter-rouge">lignin</code> is a classic, so far double-buffered, diffed VDOM for easier modularity and platform-independence.</p><p>I‚Äôll explain the basic structure in terms of this counter component:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">asteracea</span><span class="p">::</span><span class="nn">services</span><span class="p">::</span><span class="n">Invalidator</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">lignin</span><span class="p">::</span><span class="nn">web</span><span class="p">::{</span><span class="n">Event</span><span class="p">,</span> <span class="n">Materialize</span><span class="p">};</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">sync</span><span class="p">::</span><span class="nn">atomic</span><span class="p">::{</span><span class="n">AtomicUsize</span><span class="p">,</span> <span class="n">Ordering</span><span class="p">};</span>

<span class="nn">asteracea</span><span class="p">::</span><span class="nd">component!</span> <span class="p">{</span>
  <span class="cd">/// A simple counter.</span>
  <span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span> <span class="nf">Counter</span><span class="p">(</span>
    <span class="k">priv</span> <span class="k">dyn</span> <span class="n">invalidator</span><span class="p">:</span> <span class="k">dyn</span> <span class="n">Invalidator</span><span class="p">,</span>
    <span class="n">starting_count</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
  <span class="p">)(</span>
    <span class="n">class</span><span class="o">?</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'bump</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">button_text</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">"Click me!"</span><span class="p">,</span>
  <span class="p">)</span>

  <span class="o">&lt;</span><span class="n">div</span>
    <span class="py">.class</span><span class="o">?=</span><span class="p">{</span><span class="n">class</span><span class="p">}</span>

    <span class="k">let</span> <span class="k">self</span><span class="py">.count</span> <span class="o">=</span> <span class="nn">AtomicUsize</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">starting_count</span><span class="p">);</span>
    <span class="o">!</span><span class="s">"This button was clicked {} times:"</span><span class="p">(</span><span class="k">self</span><span class="py">.count</span><span class="nf">.load</span><span class="p">(</span><span class="nn">Ordering</span><span class="p">::</span><span class="n">Relaxed</span><span class="p">))</span>
    <span class="o">&lt;</span><span class="n">button</span>
      <span class="o">!</span><span class="p">(</span><span class="n">button_text</span><span class="p">)</span>
      <span class="n">on</span> <span class="n">bubble</span> <span class="n">click</span> <span class="o">=</span> <span class="n">active</span> <span class="k">Self</span><span class="p">::</span><span class="n">on_click</span>
    <span class="o">&gt;</span>
  <span class="o">/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">Counter</span> <span class="p">{</span>
  <span class="k">fn</span> <span class="nf">on_click</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This needs work.</span>
    <span class="k">let</span> <span class="n">event</span><span class="p">:</span> <span class="nn">web_sys</span><span class="p">::</span><span class="n">Event</span> <span class="o">=</span> <span class="n">event</span><span class="nf">.materialize</span><span class="p">();</span>
    <span class="n">event</span><span class="nf">.stop_propagation</span><span class="p">();</span>

    <span class="k">self</span><span class="py">.count</span><span class="nf">.fetch_add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nn">Ordering</span><span class="p">::</span><span class="n">Relaxed</span><span class="p">);</span>
    <span class="k">self</span><span class="py">.invalidator</span><span class="nf">.invalidate_with_context</span><span class="p">(</span><span class="nb">None</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>(Embedding the code here isn‚Äôt ideal, since it loses the semantic highlights it normally has via rust-analyzer. <a href="/assets/img/posts/2022-05-09-Asteracea/Counter-syntax-highlights.png">Screenshot</a>)</p><p>Components are struct types with some associated functions, so they accept documentation and a visibility, and have a name that‚Äôs an item identifier in their containing scope. (First two lines inside the macro.)</p><p>Next are the constructor parameters, in the first pair of parentheses:</p><ul><li><p><code class="language-plaintext highlighter-rouge">dyn name: Type</code> uses the dependency injection mechanism (inspired by Angular) to retrieve a value and bind it to <code class="language-plaintext highlighter-rouge">name</code>. Meanwhile, <code class="language-plaintext highlighter-rouge">Type</code> acts as a token here and not only controls what is retrieved, but also how it is made available, and, if applicable, how it is lazily injected into the dependency tree. (The entry point here is the trait <code class="language-plaintext highlighter-rouge">rhizome::sync::Extract</code>, in my development version as of now.)</p><p>A <code class="language-plaintext highlighter-rouge">dyn Trait</code> should usually extract itself as pinning sharing resource handle, which keeps the resource tree node its instance is stored in alive.</p><p>The resource tree itself is sparse and can ‚Äúskip‚Äù levels in the component hierarchy, so there is no overhead from components that don‚Äôt interact with it.</p><li><p>Prefixing a constructor parameter declaration with a visibility declares a field directly in the component and finally assigns the argument (whether extracted or plain) to it. (Lifted verbatim from Typescript.)</p><li><p><code class="language-plaintext highlighter-rouge">starting_count: usize,</code> declares a plain constructor parameter. All parameters are named, which is inspired by HTML attributes, and to a smaller extent by how properties can be assigned in Angular templates. The implementation is statically validated and should have next-to-no overhead thanks to the <em>typed-builder</em> crate, though there is some room for improvement in the implementation details (i.e. no easy repeatable parameters, and high complexity of optional arguments (which are distinct from optional parameters)).</p></ul><p>Next is the render parameter list.</p><ul><li><p>This list is used for transient values that are provided each time the component is rendered, but may flow into the generated VDOM by reference if they are annotated with the special <code class="language-plaintext highlighter-rouge">'bump</code> lifetime.</p><li><p>Placing a <code class="language-plaintext highlighter-rouge">?</code> after its name makes the parameter optional. The outwards-visible type is unchanged, but internally, it is wrapped in an <code class="language-plaintext highlighter-rouge">Option&lt;_&gt;</code>.</p><li><p>An alternative to optional parameters are default arguments, written as <code class="language-plaintext highlighter-rouge">= expr</code> in their respective parameter definition. These are evaluated for each call where the argument wasn‚Äôt specified and have access to preceding parameters. (Inspired by‚Ä¶ Python I think? The semantics are different.)</p></ul><p>A return type can be optionally specified after the render parameters, but generally this is automatic and a drop handle wrapping a VDOM node that can refer to other nodes in the bump allocator that was given to the render method by the app runtime.</p><hr /><p>Next is the main original feature of Asteracea, a <strong>mixed-style component body</strong>. ‚ÄúMixed-style‚Äù has a dual meaning here:</p><ul><li><p>The body is translated into both a constructor (<code class="language-plaintext highlighter-rouge">::new(‚Ä¶)</code>) and a VDOM-builder (<code class="language-plaintext highlighter-rouge">::render(self: Pin&lt;&amp;Self&gt;, ‚Ä¶)</code>).</p><p>Each piece of plain Rust that appears in this body is quoted into either the one or the other, so distinct sets of local variables are present in each and <code class="language-plaintext highlighter-rouge">self</code> is only available in <code class="language-plaintext highlighter-rouge">.render</code>.</p><li><p>The paradigm is mixed-declarative-imperative:</p><ul><li>You get painless state management like in React, with <strong>single statements that take care of both declaration and initialisation of local state</strong>.<li>You can freely use (certain) flow control statements like <code class="language-plaintext highlighter-rouge">for</code>-loops without wrapping them in boilerplate.<ul><li>Some differences apply: For example, loops expected to generate a value from each iteration, but this value can be the empty node <code class="language-plaintext highlighter-rouge">[]</code>. You can still use the normal versions inside a Rust-block-expression.</ul><li><strong>This is a smooth mix</strong>: Control flow (generally) translates into stored expression state management, so it‚Äôs safe to declare more fields wherever, <strong>right where you need them</strong>. (There is no implicit cross-talk between loop iterations or branches.)</ul></ul><p>I‚Äôll continue line by line again:</p><ul><li><p><code class="language-plaintext highlighter-rouge">&lt;div</code> is an opening tag. These can either be standard HTML elements as identifier (which statically validates them to some extent and enables context help (See screenshot below.)), or</p><p><img data-src="/assets/img/posts/2022-05-09-Asteracea/context-help.png" alt="A rust-analyzer popup with information on the &lt;div&gt; element, with the start of a section on accessibility." data-proofer-ignore></p><p>alternatively the element name can be written as strong literal (<code class="language-plaintext highlighter-rouge">"custom-element"</code>), which allows more flexibility at the expense of validation.</p><p>To use an Asteracea-generated component as child, you would write <code class="language-plaintext highlighter-rouge">&lt;*Child</code>, with an asterisk before the identifier. You can also write <code class="language-plaintext highlighter-rouge">&lt;{expr}</code> to only render or transclude such a child component, without instantiating it.</p><li><p><code class="language-plaintext highlighter-rouge">.class?={class}</code>: This is an optional argument (in this case an optional attribute), only set if the value is <code class="language-plaintext highlighter-rouge">Some(‚Ä¶)</code> or <code class="language-plaintext highlighter-rouge">true</code> and fully absent if it is <code class="language-plaintext highlighter-rouge">None</code> or <code class="language-plaintext highlighter-rouge">false</code>. This also works on <code class="language-plaintext highlighter-rouge">*Child</code>ren, but only with <code class="language-plaintext highlighter-rouge">Option&lt;_&gt;</code>s.</p><p>HTML attributes and render arguments are prefixed with a single <code class="language-plaintext highlighter-rouge">.</code> here. For HTML elements, the identifier can be replaced with a string literal like <code class="language-plaintext highlighter-rouge">"data-myData"</code> to skip validation.</p><p>Child components may additionally accept constructor parameters prefixed with <code class="language-plaintext highlighter-rouge">*</code>. For example, the counter above could be placed inside a parent component as follows:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">&lt;*</span><span class="n">Counter</span> <span class="o">*</span><span class="n">starting_count</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">}</span><span class="o">&gt;</span>
</pre></table></code></div></div><p>Constructor argument expressions are placed in the surrounding constructor scope and in most cases run only once when the parent component is instantiated. However, any side-effects should ideally still be <a href="https://en.wikipedia.org/w/index.php?title=Idempotence&amp;oldid=1077502153">idempotent</a> regardless, to make debugging easier.</p><li><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="k">self</span><span class="py">.count</span> <span class="o">=</span> <span class="nn">AtomicUsize</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">starting_count</span><span class="p">);</span>
</pre></table></code></div></div><p>This is React‚Äôs <code class="language-plaintext highlighter-rouge">useState</code>, except that it can be placed anywhere. <strong>The Rust expression on the right is constructor-scoped</strong>, so it can see <code class="language-plaintext highlighter-rouge">starting_count</code> but not, for example, <code class="language-plaintext highlighter-rouge">button_text</code>.</p><blockquote><p>The field is statically-typed. The above is actually a shorthand for:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="k">self</span><span class="py">.count</span><span class="p">:</span> <span class="n">AtomicUsize</span> <span class="o">=</span> <span class="nn">AtomicUsize</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">starting_count</span><span class="p">);</span>
</pre></table></code></div></div><p>I used a bit of macro-magic to make that possible, as there is unfortunately no true field type inference.</p></blockquote><p>Fields declared this way can also be published (Their visibility follows <code class="language-plaintext highlighter-rouge">let</code> but is normally the implicit one.), though in this case that‚Äôs not a good idea since setting it directly would not invalidate the rendered GUI state.</p><li><p>The next line does string formatting: <code class="language-plaintext highlighter-rouge">!"format string"(args)</code> is the general pattern, though the implementation specifics are delegated to <code class="language-plaintext highlighter-rouge">bumpalo</code>.</p><p>You can write <code class="language-plaintext highlighter-rouge">!(arg)</code> to imply the format string <code class="language-plaintext highlighter-rouge">"{}"</code>.</p><li><p><code class="language-plaintext highlighter-rouge">&lt;button</code> - a nested HTML element, one of the recursion points of this grammar. You can also nest child components, and you can nest HTML elements and child components inside a container component to transclude them. (More on that later: Asteracea‚Äôs transclusion is a bit fancier than what e.g. Angular or React can do, closer to WPF‚Äôs in power.)</p><li><p>The next line is just string formatting again, which brings us to:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">on</span> <span class="n">bubble</span> <span class="n">click</span> <span class="o">=</span> <span class="n">active</span> <span class="k">Self</span><span class="p">::</span><span class="n">on_click</span>
</pre></table></code></div></div><p>Event handlers are currently the most shaky aspect of Asteracea and I‚Äôll likely have to rework some of their details a bit, so I‚Äôll be brief:</p><p>Event bindings are on average allocation free (callback registry with drop notifications) and the use of modifiers (<code class="language-plaintext highlighter-rouge">bubble</code> vs. <code class="language-plaintext highlighter-rouge">capture</code> vs. nothing, and use of <code class="language-plaintext highlighter-rouge">active</code> after <code class="language-plaintext highlighter-rouge">=</code> to <code class="language-plaintext highlighter-rouge">event.prevent_default()</code>) is statically validated if the event is. (As usual, you can use a string literal for the event name to skip validation.)</p><p>The handler can have a number of different signatures, and can also be written inline as currently <code class="language-plaintext highlighter-rouge">fn (self, event) { ‚Ä¶ }</code> (not a closure).</p><p>Event bindings on child components are not yet supported, but will use uniform syntax with event subscriptions on HTML elements once available. Support for bubbling event bindings outside the HTML DOM is up in the air; personally I find good direct events to be cleaner, and for skipping layers there‚Äôs the DI system already.</p><li><p><code class="language-plaintext highlighter-rouge">&gt;</code> closes an HTML element or child component without restating its name.</p><li><code class="language-plaintext highlighter-rouge">/div&gt;</code> closes that HTML element while restating its name. This is validated statically and the element‚Äôs context help is available on this closing tag.</ul><h3 id="few-composite-allocations">Few, Composite Allocations<a href="#few-composite-allocations" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>(inspired by Rust‚Äôs async blocks)</p><p>Asteracea relies very heavily on data inlining to reduce memory use and improve cache behaviour.</p><p>Most Asteracea-components don‚Äôt allocate directly, and their use elsewhere also does not automatically incur an allocation, as child components are (non-generically) inlined into their parents.</p><p>There are a few exceptions to this: <code class="language-plaintext highlighter-rouge">box</code> expressions explicitly heap-allocate the storage for their contents, and e.g. <code class="language-plaintext highlighter-rouge">for</code> loops are storage container expressions that manage storage instances on the heap. Conversely, simple branches like <code class="language-plaintext highlighter-rouge">match</code> (or <code class="language-plaintext highlighter-rouge">if</code>, which in Asteracea is direct syntactic sugar for the former) can use fully inlined storage either as <code class="language-plaintext highlighter-rouge">enum</code> or <code class="language-plaintext highlighter-rouge">struct</code>.</p><p>As components must be pinned to be rendered, the <code class="language-plaintext highlighter-rouge">asteracea::component!</code> macro safely implements pin projections for the fields storing child component instances.</p><p>(If you create branches with vastly different storage sizes, that does seem to get flagged by Clippy. You can then <code class="language-plaintext highlighter-rouge">box</code> one or more of the branches to dynamically use less memory.)</p><h3 id="rich-tooling-compatibility">Rich Tooling Compatibility<a href="#rich-tooling-compatibility" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Asteracea preserves source code spans and assigns those of synthetic tokens based on fine-grained context. This means that most error messages and warnings are already very precise with just rust-analyzer.</p><p>Additionally, there are custom messages for domain-specific errors, like in the following case:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">on</span> <span class="n">bubble</span> <span class="n">error</span> <span class="o">=</span> <span class="n">active</span> <span class="k">fn</span> <span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="p">{}</span>
   <span class="o">~~~~~~</span>         <span class="o">~~~~~~</span>
</pre></table></code></div></div><ul><li>evaluation of constant value failed<br /> the evaluated program panicked at ‚ÄòKeyword <code class="language-plaintext highlighter-rouge">bubble</code> is not valid for this event; the event does not bubble.‚Äô<li>evaluation of constant value failed<br /> the evaluated program panicked at ‚ÄòKeyword <code class="language-plaintext highlighter-rouge">active</code> is not valid for this event; the event is not cancellable.‚Äô</ul><p>(This isn‚Äôt perfect: Rustc‚Äôs spans are less accurate than rust-analyzer‚Äôs (but still useful) and I‚Äôd love to get rid of the <code class="language-plaintext highlighter-rouge">evaluation of constant value failed</code>, <code class="language-plaintext highlighter-rouge">the evaluated program panicked at '</code>, <code class="language-plaintext highlighter-rouge">'</code> parts entirely. It‚Äôs in my eyes at least close to a dedicated editor integration, though, and <a href="https://marketplace.visualstudio.com/items?itemName=usernamehw.errorlens">Error Lens</a> is able to display the message inline with little clutter.)</p><p>Span preservation also gives you access to some rust-analyzer quick fixes inside the macro, though not all of them currently work correctly. I‚Äôm not sure how much I can improve them with the current proc macro API on stable, so for now I‚Äôm biding my time before attempting higher levels of polish in this regard.</p><p>Additionally, you can step-debug into components somewhat decently. (There is room for improvement here though, likely by adjusting the <code class="language-plaintext highlighter-rouge">Span</code>s for generated code some more.)</p><h3 id="keyed-repetition">Keyed Repetition<a href="#keyed-repetition" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>(inspired by loops in Angular templates)</p><p>It‚Äôs very easy to construct dynamic list displays using loops in the component body:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nn">asteracea</span><span class="p">::</span><span class="nd">component!</span> <span class="p">{</span>
    <span class="nf">ListVisual</span><span class="p">()(</span>
        <span class="c1">// Side-note: Supporting this kind of parameter type is pretty tricky.</span>
        <span class="n">items</span><span class="p">:</span> <span class="k">impl</span> <span class="nb">IntoIterator</span><span class="o">&lt;</span><span class="n">Item</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nv">'_</span> <span class="n">SomeItem</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="o">&lt;</span><span class="n">ul</span>
        <span class="k">for</span> <span class="n">item</span> <span class="n">in</span> <span class="n">items</span> <span class="p">{</span>
            <span class="o">&lt;</span><span class="n">li</span>
                <span class="n">bind</span> <span class="o">&lt;*</span><span class="n">CaptureItem</span> <span class="o">*</span><span class="n">item</span><span class="o">=</span><span class="p">{</span><span class="n">item</span><span class="p">}</span><span class="o">&gt;</span>
            <span class="o">&gt;</span>
        <span class="p">}</span>
    <span class="o">/</span><span class="n">ul</span><span class="o">&gt;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>This list is auto-keyed (which has a bit of overhead vs. specifying the key type manually (also possible), <a href="https://github.com/rust-lang/rust/issues/63063">until <code class="language-plaintext highlighter-rouge">type ‚Ä¶ = impl ‚Ä¶;</code> becomes available</a>), which means <strong>the storage contexts for its body are automatically reused, reordered, and reinitialised only as needed</strong>.</p><p>There is a bit of an oddity here: The constructor parameter <code class="language-plaintext highlighter-rouge">*item</code> on <code class="language-plaintext highlighter-rouge">*CaptureItem</code> receives data originally from the render parameter <code class="language-plaintext highlighter-rouge">items</code>. This is possible because <code class="language-plaintext highlighter-rouge">bind</code> moves the constructor of its argument into the render scope (as Rust closure), running it once when first rendered.</p><p>Stored loop body state is dropped when the loop runs again and that item is missing.</p><p>(Key repetitions are fine, but it‚Äôs strictly the last ones for each key that are added or removed.)</p><h3 id="un-keyed-repetition">Un-keyed Repetition<a href="#un-keyed-repetition" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>You can loop in the constructor of a component instead by writing <code class="language-plaintext highlighter-rouge">*for</code>. This is evaluated only once when the surrounding expression (usually the component) is initialised, has exactly the same semantics as a plain Rust loop (aside from generating items), and generates the VDOM a bit more efficiently than the render-scoped loops above.</p><h3 id="transclusion-and-parentcontainer-parameters">Transclusion and Parent/Container Parameters<a href="#transclusion-and-parentcontainer-parameters" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>(inspired by transclusion in Angular and attached properties in WPF)</p><p>My code calls these ‚Äúparent parameters‚Äù, but I‚Äôm not sure which term is better in practice.</p><p>Take snippet example for instance:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="o">&lt;*</span><span class="n">Router</span>
  <span class="c1">// I'll redo how the paths are specified.</span>
  <span class="k">-&gt;</span><span class="n">path</span><span class="o">=</span><span class="p">{</span><span class="s">"/div/*"</span><span class="p">}</span> <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span>
  <span class="k">-&gt;</span><span class="n">path</span><span class="o">=</span><span class="p">{</span><span class="s">"/span/*"</span><span class="p">}</span> <span class="o">&lt;</span><span class="n">span</span><span class="o">&gt;</span>
<span class="o">&gt;</span>
</pre></table></code></div></div><p>Here, two child expressions are handed to the <code class="language-plaintext highlighter-rouge">Router</code> instance during rendering. (They are constructed eagerly with the expression that contains this code, but you can easily <code class="language-plaintext highlighter-rouge">defer</code> that in most cases. Here I haven‚Äôt done it because purely HTML expressions don‚Äôt need storage or construction.)</p><p>This functions via closures, so while outer variables are visible, the <code class="language-plaintext highlighter-rouge">Router</code> can decide which branch to actually render here each GUI frame.</p><p>The <code class="language-plaintext highlighter-rouge">-&gt;path</code> argument is fully statically typed and validated against <code class="language-plaintext highlighter-rouge">Router</code>‚Äôs render method signature, and passed along by value with each child.</p><p>Transclusion slots can be named and distinct slots can accept different sets of arguments. The child parameter slot on <code class="language-plaintext highlighter-rouge">Router</code> in this case is repeatable and anonymous. I haven‚Äôt yet implemented good syntactic sugar for declaring these, so that‚Äôs currently a bit cumbersome.</p><p>A single non-repeating anonymous content parameter can currently be declared as <code class="language-plaintext highlighter-rouge">..</code>, and can also be pasted as <code class="language-plaintext highlighter-rouge">..</code> in the component body. This is a placeholder and likely to change.</p><h3 id="coloured-async-and-named-slots">Coloured Async and Named Slots<a href="#coloured-async-and-named-slots" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>There isn‚Äôt really much to say about these features, as they follow directly from Rust‚Äôs interpretation of coroutines and child transclusion via (named in general) render parameters.</p><p>Asteracea components may be asynchronous and <code class="language-plaintext highlighter-rouge">.await</code>ed in asynchronous expressions, which may be the body of an asynchronous component or created by the <code class="language-plaintext highlighter-rouge">async</code> keyword.</p><p>Slots can be named (I used lifetime labels here, since that results in nice syntax highlights.) and a slot can also be set up to accept an asynchronous expression.</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="k">async</span> <span class="k">fn</span> <span class="nf">future_text</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="s">"Like a record!"</span><span class="nf">.to_string</span><span class="p">()</span>
<span class="p">}</span>

<span class="nn">asteracea</span><span class="p">::</span><span class="nd">component!</span> <span class="p">{</span>
    <span class="nf">Spinner</span><span class="p">()()</span>

    <span class="s">"Spinning right 'round‚Ä¶"</span>
<span class="p">}</span>

<span class="nn">asteracea</span><span class="p">::</span><span class="nd">component!</span> <span class="p">{</span>
    <span class="k">async</span> <span class="nf">Async</span><span class="p">()()</span>

    <span class="k">let</span> <span class="k">self</span><span class="py">.text</span><span class="p">:</span> <span class="nb">String</span> <span class="o">=</span> <span class="nf">future_text</span><span class="p">()</span><span class="k">.await</span><span class="p">;</span>
    <span class="o">!</span><span class="s">"{}"</span><span class="p">(</span><span class="k">self</span><span class="py">.text</span><span class="p">)</span>
<span class="p">}</span>

<span class="nn">asteracea</span><span class="p">::</span><span class="nd">component!</span> <span class="p">{</span>
    <span class="nf">Instant</span><span class="p">()()</span>

    <span class="o">&lt;*</span><span class="n">Suspense</span>
        <span class="nv">'spinner</span><span class="p">:</span> <span class="o">&lt;*</span><span class="n">Spinner</span><span class="o">&gt;</span>
        <span class="nv">'ready</span><span class="p">:</span> <span class="k">async</span> <span class="o">&lt;*</span><span class="n">Async</span><span class="k">.await</span><span class="o">&gt;</span>
    <span class="o">&gt;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>(That‚Äôs essentially a clone of React‚Äôs <code class="language-plaintext highlighter-rouge">Suspense</code>, just Rust-y.)</p><p>The storage for both the <code class="language-plaintext highlighter-rouge">Spinner</code> and <code class="language-plaintext highlighter-rouge">Async</code> is managed by (and inlined into) <code class="language-plaintext highlighter-rouge">Instant</code>, so <code class="language-plaintext highlighter-rouge">Suspense</code> can be fairly¬π non-generic, as transclusion is largely type-erased.</p><p>However, <code class="language-plaintext highlighter-rouge">Suspense</code> controls how the underlying <code class="language-plaintext highlighter-rouge">Future</code> is driven (holding onto a cancellation token and scheduling a small driver-<code class="language-plaintext highlighter-rouge">Future</code> using an injected <code class="language-plaintext highlighter-rouge">ContentRuntime</code> implementation) and takes care of invalidation (by cloning and passing along an optionally-injected <code class="language-plaintext highlighter-rouge">Invalidator</code> handle).</p><h3 id="dependency-injection">Dependency Injection<a href="#dependency-injection" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>(inspired by Angular, but strictly at runtime)</p><p>It‚Äôs quite easy to declare resource tokens for injection, here for example the <code class="language-plaintext highlighter-rouge">ContentRuntime</code> declaration in its entirety:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c1">// src/services/content_runtime.rs</span>

<span class="k">use</span> <span class="k">crate</span><span class="p">::</span><span class="nn">include</span><span class="p">::</span><span class="nn">async_</span><span class="p">::</span><span class="n">ContentFuture</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">rhizome</span><span class="p">::</span><span class="nn">sync</span><span class="p">::</span><span class="n">derive_dependency</span><span class="p">;</span>

<span class="cd">/// A resource used by [`Suspense`](`crate::components::Suspense`) to schedule [`ContentFuture`]s.</span>
<span class="k">pub</span> <span class="k">trait</span> <span class="n">ContentRuntime</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">start_content_future</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">content_future</span><span class="p">:</span> <span class="n">ContentFuture</span><span class="p">);</span>
<span class="p">}</span>
<span class="nd">derive_dependency!</span><span class="p">(</span><span class="k">dyn</span> <span class="n">ContentRuntime</span><span class="p">);</span>

<span class="c1">// Specific implementation:</span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">F</span><span class="p">:</span> <span class="nf">Fn</span><span class="p">(</span><span class="n">ContentFuture</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">ContentRuntime</span> <span class="k">for</span> <span class="n">F</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">start_content_future</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">content_future</span><span class="p">:</span> <span class="n">ContentFuture</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="p">(</span><span class="n">content_future</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>(Injection of concrete data-holding types is set up a bit differently.)</p><p>As <code class="language-plaintext highlighter-rouge">ContentRuntime</code> in particular is blanket-implemented over certain closures, providing an implementation to your app is then as easy as writing:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">// Given to the root component manually, but otherwise managed implicitly.</span>
<span class="k">let</span> <span class="n">root</span> <span class="o">=</span> <span class="nn">Node</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="nn">TypeId</span><span class="p">::</span><span class="nn">of</span><span class="p">::</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="p">());</span>

<span class="o">&lt;</span><span class="k">dyn</span> <span class="n">ContentRuntime</span><span class="o">&gt;</span><span class="p">::</span><span class="nf">inject</span><span class="p">(</span><span class="n">root</span><span class="nf">.as_ref</span><span class="p">(),</span> <span class="p">|</span><span class="n">content_future</span><span class="p">|</span> <span class="p">{</span>
    <span class="c1">// `ContentFuture` is `'static + Unpin + Send + Future&lt;Output = ()&gt; + FusedFuture` and completely type-erased and semantically fire-and-forget,</span>
    <span class="c1">// and as such trivially compatible with practically every single Rust async runtime out there.</span>
<span class="p">});</span>
</pre></table></code></div></div><p>A container component‚Äôs dependency injection node is parent to that of transcluded children. This allows <code class="language-plaintext highlighter-rouge">Invalidator</code>-interception for memoisation, for example.</p><p>As mentioned above, dependency injection into components is done by declaring a constructor parameters like</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">dyn</span> <span class="n">runtime</span><span class="p">:</span> <span class="k">dyn</span> <span class="n">ContentRuntime</span><span class="p">,</span>
</pre></table></code></div></div><p>but it‚Äôs also possible to not strictly require the runtime by making the parameter optional:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">dyn</span> <span class="n">runtime</span><span class="o">?</span><span class="p">:</span> <span class="k">dyn</span> <span class="n">ContentRuntime</span><span class="p">,</span>
</pre></table></code></div></div><h3 id="memoisation">Memoisation<a href="#memoisation" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Between Invalidator injection, transclusion that flows the dependency context, and a drop-guarded VDOM, it‚Äôs <em>relatively</em> straightforward to implement a memoisation component usable like this:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="o">&lt;*</span><span class="n">Memo</span>
  <span class="c1">// ‚Ä¶further content‚Ä¶</span>
<span class="o">&gt;</span>
</pre></table></code></div></div><p>And if you need to externally invalidate the <code class="language-plaintext highlighter-rouge">Memo</code>, you could name the field it is stored in to call methods on it:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="o">&lt;*</span><span class="n">Memo</span> <span class="k">priv</span> <span class="n">memo</span>
  <span class="c1">// ‚Ä¶further content‚Ä¶</span>
<span class="o">&gt;</span>

<span class="c1">// ‚Ä¶</span>

<span class="k">self</span><span class="py">.memo</span><span class="nf">.invalidate</span><span class="p">();</span>
</pre></table></code></div></div><p>(My current memoisation component has a slightly different API, is on a feature branch, and is not in a clean shape. I‚Äôll likely optimise and clean it only after working on some other features first.)</p><h3 id="sparse-vdom-drop-guards">Sparse VDOM Drop Guards<a href="#sparse-vdom-drop-guards" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>The VDOM tree itself can be trivially dropped, so double-buffering it with a rotating pair of bump allocators is very efficient.</p><p>However, the memoisation component above must know when it‚Äôs safe to drop a cached version of the VDOM, without direct knowledge of the main allocators‚Äô <code class="language-plaintext highlighter-rouge">unsafe</code> rotation at the app root.</p><p>Relying on a safety contract that prescribes an app lifecycle with repeating elements seemed error-prone, so instead Asteracea uses sparsely aggregated drop guard trees stored in the same bump allocators as the VDOM nodes.</p><p>These <em>may</em> contain a type-erased drop notification (as well as the VDOM node they guard), but most importantly can be <code class="language-plaintext highlighter-rouge">unsafe</code>ly split into the notification and VDOM node.</p><p>The component macro aggregates the former from child components, only pushing a pair into the allocator where collisions happen, and then composes them with the VDOM node it created to create a safe return value.</p><p>If an error or unwind happens while these parts are split, the drop notification is sent and the macro guarantees that the formerly-guarded VDOM nodes are never accessed.</p><h3 id="server-side-rendering-and-hydration">Server-side Rendering and Hydration<a href="#server-side-rendering-and-hydration" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>As Asteracea is fundamentally platform-agnostic, it‚Äôs possible to run applications natively on a server without changes to the application code. (If you need different output, you can reconfigure aspects of an app through dependency injection, e.g. by not injecting a user credentials service or by injecting dummy async runtimes that never poll the <code class="language-plaintext highlighter-rouge">Future</code>‚Äôs.)</p><p><code class="language-plaintext highlighter-rouge">lignin-html</code> can render <code class="language-plaintext highlighter-rouge">lignin</code> VDOMs into HTML documents, and <code class="language-plaintext highlighter-rouge">lignin-dom</code> can read the DOM tree into a VDOM tree, effectively hydrating it in place on first diff.</p><h3 id="element-bindings">Element Bindings<a href="#element-bindings" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Element bindings function similarly to event subscriptions and give a component running client-side access to the DOM element instance, by notifying it of changes and asking it to clean up when removed from the rendered view.</p><p>I haven‚Äôt really given this feature much thought yet, but it‚Äôs there and should be enough to host JavaScript components.</p><h3 id="room-for-modifications">Room for Modifications<a href="#room-for-modifications" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>The lignin DOM update specification carves out some niches for uncontrolled modifications of the page structure, to make it easier for users to adjust the appearance of pages or add functionality using e.g. web extensions.</p><p>With at least my differ, apps won‚Äôt interfere with extra child nodes in an element as long as they follow the app-managed ones, or extra attributes or extra event bindings. (There is no external notification in cases where a DOM element instance happens to be repurposed, though, so extensions must subscribe to DOM changes to stay in sync.)</p><p>Additionally, the differ is at the same time resilient enough to detect inconsistencies with the tolerated DOM state and recreate parts of it more aggressively where needed.</p><h3 id="a-declarative-compile-time-schema-library">A Declarative Compile-Time Schema Library<a href="#a-declarative-compile-time-schema-library" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Asteracea‚Äôs knowledge of HTML is provided by the <code class="language-plaintext highlighter-rouge">lignin-schema</code> crate, the source code of which you can find here: <a href="https://github.com/Tamschi/lignin-schema/blob/develop/src/lib.rs">lignin-schema/src/lib.rs</a></p><p>The macros encode information about elements, attributes and events into the Rust type system and attach meta data (documentation and deprecations) as attributes, while the <code class="language-plaintext highlighter-rouge">asteracea::component!</code> macro does not have this information and instead just emits validating const expressions and constructs the relevant type paths.</p><p>The actual schema validation is then done only by the Rust compiler, which also makes it possible to have automatic in-editor completions for element names and for rust-analyzer to provide documentation on hover. (The macro could be more lenient to allow completions to work in more cases.)</p><blockquote><p>You may notice that one of the macro <a href="https://github.com/Tamschi/lignin-schema/blob/a60d7ac84ded70858cfa82cc41826585697d9085/src/lib.rs#L84">upper-cases all element names</a>. I somewhat boldly assumed a differ might want to use <code class="language-plaintext highlighter-rouge">Element.tagName</code> inside an HTML document without doing a case-sensitive comparison here, but maybe lower-casing everything would be better in light of Brotli compression.</p><p>I don‚Äôt think it really matters all that much when using a double-buffered VDOM, at least, since the renderer would only have to adjust casings once during hydration.</p></blockquote><h3 id="plain-extra-impls">Plain Extra Impls<a href="#plain-extra-impls" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>As the entirety of component‚Äôs state is stored in ‚Äújust fields‚Äù, it‚Äôs easy to extend a component‚Äôs API.</p><p>For example, the following could be added to the counter component above‚Äôs module to give its parent access to the counter state:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">impl</span> <span class="n">Counter</span> <span class="p">{</span>
  <span class="k">pub</span> <span class="k">fn</span> <span class="nf">count</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">self</span><span class="py">.count</span><span class="nf">.load</span><span class="p">(</span><span class="nn">Ordering</span><span class="p">::</span><span class="n">Relaxed</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">pub</span> <span class="k">fn</span> <span class="nf">increment</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">self</span><span class="py">.count</span><span class="nf">.fetch_add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nn">Ordering</span><span class="p">::</span><span class="n">Relaxed</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>As long as the parent binds the instance to a name, like here‚Ä¶</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nn">asteracea</span><span class="p">::</span><span class="nd">component!</span> <span class="p">{</span>
  <span class="nf">Parent</span><span class="p">()()</span>

  <span class="o">&lt;*</span><span class="n">Counter</span> <span class="k">priv</span> <span class="n">counter</span>
    <span class="o">*</span><span class="n">starting_count</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">}</span>
  <span class="o">&gt;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>It can then call these as e.g. <code class="language-plaintext highlighter-rouge">self.counter.count()</code>.</p><p>Some methods may require a <code class="language-plaintext highlighter-rouge">Pin&lt;&amp;Self&gt;</code>. For fields that require pinning, like child components, a matching pin projection method is also available. In this case, <code class="language-plaintext highlighter-rouge">self.counter_pinned().count()</code> would also work that way as long as <code class="language-plaintext highlighter-rouge">self</code> is at least a <code class="language-plaintext highlighter-rouge">Pin&lt;&amp;Parent&gt;</code>.</p><h3 id="no-effort-instrumentation">No-Effort Instrumentation<a href="#no-effort-instrumentation" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>You only have to enable Asteracea‚Äôs <code class="language-plaintext highlighter-rouge">"tracing"</code> feature to automatically instrument all constructors and render methods with tracing spans and log all their arguments. (This uses <a href="https://lukaskalbertodt.github.io/2019/12/05/generalized-autoref-based-specialization.html">auto-deref-specialisation</a> internally, so you get meaningful argument logs depending on which traits are available on them, without having to worry about incompatibilities.)</p><blockquote><p>Please wrap any sensitive information you pass around in your program in a debug-opaque newtype to avoid accidental logging. The <code class="language-plaintext highlighter-rouge">lignin-‚Ä¶</code> crates, once published to Crates.io in their instrumented version, similarly should provide only redacted logs by default, unless content logging is explicitly enabled via a feature.)</p></blockquote><p>You also get nice performance traces in the browser if you use <a href="https://lib.rs/crates/tracing-wasm">tracing-wasm</a>. I‚Äôd like to eventually write a proper debug interface and browser extension to inspect the app state, but for now that‚Äôs quite far off.</p><p>One caveat here is that <code class="language-plaintext highlighter-rouge">async</code> constructors aren‚Äôt quite properly instrumented due to <a href="https://github.com/tokio-rs/tracing/pull/1819">some difficulties</a> with the <code class="language-plaintext highlighter-rouge">tracing::instrument</code> attribute macro. It seems my PR in this regard might land soon though, at which point adjusting Asteracea to use that macro again should be quick and easy.</p><p>There is also <a href="https://github.com/Tamschi/Asteracea/issues/86">a potential parameter name collision</a> with this feature that still needs to be solved, though ideally upstream.</p><h2 id="odd-features">Odd Features<a href="#odd-features" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>I‚Äôll probably scrap or evolve these from their current form, since they have usability drawbacks.</p><h3 id="thread-safety-inference">Thread Safety Inference<a href="#thread-safety-inference" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Asteracea components (by default only in the same crate) can transitively infer the thread-safety tag of their resulting VDOM, entirely at compile time.</p><p>At least in theory that, since there seem to be frequent edge cases where this trips up type inference somewhat. (The core hack is deanonymization of opaque (<code class="language-plaintext highlighter-rouge">impl ‚Ä¶</code>) return types through the auto trait side channel. You can find more information on that in the <a href="https://docs.rs/lignin/0.1.0/lignin/auto_safety/index.html"><code class="language-plaintext highlighter-rouge">lignin::auto_safety</code></a> docs.)</p><p>I‚Äôm considering letting all component-generated VDOM be only <code class="language-plaintext highlighter-rouge">!Sync</code> by default, while keeping the option to safely state otherwise. This would remove those edge cases (mostly dependency loops) where inference suddenly fails, and would <em>probably</em> improve build times a little.</p><h3 id="native-gui-targets">Native GUI Targets<a href="#native-gui-targets" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>There‚Äôs nothing really stopping you from rendering a <code class="language-plaintext highlighter-rouge">lignin</code> VDOM in terms of a native GUI framework, however this currently maybe isn‚Äôt the best fit depending on the framework in question.</p><p>As Asteracea doesn‚Äôt really take care of event bubbling and assumes all standard elements are present, a fairly thick glue layer may be required to make this work nicely.</p><p>I made a quick proof of concept in this space, and it works well with low requirements, but this is not something I plan to pursue immediately.</p><h2 id="future-work">Future Work<a href="#future-work" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>There are a few open points that I still haven‚Äôt figured out:</p><h3 id="more-syntaxsyntax-revisions">More syntax/syntax revisions<a href="#more-syntaxsyntax-revisions" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>I‚Äôd like to add plain <code class="language-plaintext highlighter-rouge">let</code> (and <code class="language-plaintext highlighter-rouge">*let</code>) bindings directly to the body grammar, and in exchange remove the <code class="language-plaintext highlighter-rouge">with {}</code> blocks that paste Rust code into the constructor or render function.</p><p>Flow control expressions should consistently use <code class="language-plaintext highlighter-rouge">{}</code> around their branches, while embedded Rust expressions should be more explicit than that.</p><p>There are also some flow control expressions or expression variants that aren‚Äôt implemented yet.</p><p>Attribute/argument syntax is a bit too verbose. I should be able to make the <code class="language-plaintext highlighter-rouge">{}</code> optional (though expressions with <code class="language-plaintext highlighter-rouge">.</code> will have to be parenthesised, still).</p><h3 id="an-efficient-render-context">An efficient render-context<a href="#an-efficient-render-context" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>This would make it easier to propagate transient state along the component tree, with the option to later remove contents from it without re-creating the affected components.</p><p><em>rhizome</em> is not suitable for this, as it unconditionally allocates at least twice for each new populated resource scope and is inflexible regarding removals.</p><h3 id="a-mockable-asynchronous-http-client">A mockable asynchronous HTTP client<a href="#a-mockable-asynchronous-http-client" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>This should be a trait in Asteracea‚Äôs standard library, to be used as injected dependency.</p><p>(I‚Äôll likely clone <code class="language-plaintext highlighter-rouge">hyper</code>‚Äôs API for this on some level, but I haven‚Äôt really looked into this.)</p><h3 id="optimisation">Optimisation<a href="#optimisation" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Asteracea feels fast as-is, but there‚Äôs likely a bunch of potential in giving the crates I proof-of-concept‚Äôd as dependencies any optimisation pass at all.</p><p>(I‚Äôve constructed the public crate APIs with efficiency in mind already, but I took some shortcuts here and there as far as the internals go. This is my unpaid hobbyist project, after all, so I have to cut corners <em>somewhere</em> ;-) )</p><h3 id="a-remnant-api-and-implementation">A <code class="language-plaintext highlighter-rouge">Remnant</code> API and implementation<a href="#a-remnant-api-and-implementation" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>There‚Äôs currently only a placeholder VDOM node variant.</p><p>‚ÄúRemnants‚Äù (as I call them) are (to be) lingering pieces of the DOM that are preserved for a while even after they are removed from the VDOM, existing outside the usual app update flow. This makes them useful for animating-out nodes.</p><h3 id="raw-html-pasting">Raw HTML Pasting<a href="#raw-html-pasting" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>I haven‚Äôt added this to the VDOM since I personally don‚Äôt need it, but someone is going to want that feature before long.</p><h3 id="data-binding">Data Binding<a href="#data-binding" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>(This is a wishlist feature that I haven‚Äôt gotten around to seriously working on yet. I only have vague ideas how to implement this.)</p><p>Declaring <code class="language-plaintext highlighter-rouge">Cell</code>s and other interior-mutable fields seems okay when using the shorthand syntax, but I‚Äôd like to simplify how they are updated in high-level components. Take the following <strong>currently not functional syntax sketch</strong> for example (inspired by Angular):</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nn">asteracea</span><span class="p">::</span><span class="nd">component!</span> <span class="p">{</span>
  <span class="nf">DataBinding</span><span class="p">()()</span>

  <span class="k">let</span> <span class="k">self</span><span class="py">.data</span> <span class="o">=</span> <span class="nn">RefCell</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="s">""</span><span class="nf">.to_string</span><span class="p">());</span>

  <span class="o">&lt;*</span><span class="n">TextField</span> .<span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">=</span><span class="p">{</span><span class="o">&amp;</span><span class="k">self</span><span class="py">.data</span><span class="p">}</span><span class="o">&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span>
  <span class="s">"The text is currently: "</span> <span class="o">!</span><span class="p">(</span><span class="k">self</span><span class="py">.data</span><span class="nf">.borrow</span><span class="p">())</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The details of the binding implementation can be provided by a trait, similarly to how optional arguments work already. This way, you could use a plain <code class="language-plaintext highlighter-rouge">Cell</code> for types that are <code class="language-plaintext highlighter-rouge">Copy</code>.</p><p>It <em>should</em> be possible to reuse the callback registry mechanism that DOM event subscriptions use here, with the control component (<code class="language-plaintext highlighter-rouge">TextField</code>) storing a <code class="language-plaintext highlighter-rouge">CallbackReference</code> it receives as render parameter. <code class="language-plaintext highlighter-rouge">lignin</code>‚Äôs <a href="https://docs.rs/lignin/0.1.0/lignin/callback_registry/struct.CallbackRef.html"><code class="language-plaintext highlighter-rouge">CallbackRef</code></a>s are opaque weak handles (meaning they contain only a number and are <code class="language-plaintext highlighter-rouge">Copy</code>), so there‚Äôs little overhead to just replacing them on render.</p><p>Such data bindings should also automatically invalidate the current component using an implied <code class="language-plaintext highlighter-rouge">priv dyn __Asteracea__invalidator? = dyn ::asteracea::services::Invalidator</code> added to the constructor parameter list.</p><h2 id="planned-features">Planned Features<a href="#planned-features" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>The following are <em>in theory</em> solved problems, but implementing each solution would either be a fairly large amount of work for me right now or is lower-priority for other reasons.</p><h3 id="a-component-trait">A component trait<a href="#a-component-trait" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Components are currently duck-typed, with a mix of attached methods and type inference hacks to instantiate the appropriate arguments builders.</p><p>It should be possible to at least partially implement a trait for the interface instead, which would make component implementations <em>not</em> using the <code class="language-plaintext highlighter-rouge">component!</code> macro a bit easier.</p><h3 id="repeat-parameters">Repeat parameters<a href="#repeat-parameters" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Similarly to optional parameters with <code class="language-plaintext highlighter-rouge">?</code>, the following declarations should also be valid in the parameter lists:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">zero_or_more</span><span class="o">*</span><span class="p">:</span> <span class="n">Type</span><span class="p">,</span> <span class="c1">// Vec&lt;_&gt;?</span>
<span class="n">one_or_more</span><span class="o">+</span><span class="p">:</span> <span class="n">Type</span><span class="p">,</span> <span class="c1">// `Vec1&lt;_&gt;` or similar</span>
<span class="n">optionally_one_or_more</span><span class="o">+?</span><span class="p">:</span> <span class="n">Type</span><span class="p">,</span> <span class="c1">// `Option&lt;Vec1&lt;_&gt;&gt;`</span>
<span class="n">optionally_zero_or_more</span><span class="o">*?</span><span class="p">:</span> <span class="n">Type</span><span class="p">,</span> <span class="c1">// largely just for completeness, `Option&lt;Vec&lt;_&gt;&gt;`</span>
</pre></table></code></div></div><p>Then, on the caller side, it should be possible to repeatedly add arguments for these parameters (or transcluded children to the same variadic slot!) and/or to spread an <code class="language-plaintext highlighter-rouge">IntoIter&lt;Item = Type&gt;</code> into them.</p><p>I started work on the necessary infrastructure <a href="https://github.com/idanarye/rust-typed-builder/pull/46">quite a while ago</a>, but so far haven‚Äôt found the time and peace of mind to complete this pull request.</p><h3 id="better-missing-argument-errors-on-child-components">Better missing argument errors on child components<a href="#better-missing-argument-errors-on-child-components" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Now that const expression panics are available and appear as compile-time errors, it should be fairly straightforward to validate argument presence that way (using the same kind of method chaining as the actual builder, but without argument values). The raised panic would then appear as error on the child component‚Äôs identifier or reference-expression, and could clearly list which fields are still missing.</p><p>(Ideally this would replace the deprecation message and errors from <em>typed-builder</em>, but I‚Äôm not entirely certain how feasible that is. I <em>think</em> it will be possible once <a href="https://github.com/rust-lang/rust/issues/76001">inline <code class="language-plaintext highlighter-rouge">const { ‚Ä¶ }</code> blocks</a> are available, as then this block could provide the initial builder and, on error, result in a somewhat more lenient vacant dummy type instead.)</p><h2 id="other-issues">Other Issues<a href="#other-issues" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>For various additional rough edges, please see <a href="https://github.com/Tamschi/Asteracea/issues">Asteracea‚Äôs issues</a> on GitHub.</p><h2 id="how-to-support-this-project-or-me-personally">How to support this project or me personally<a href="#how-to-support-this-project-or-me-personally" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>There are two good ways for individuals to contribute to Asteracea‚Äôs development right now:</p><ul><li><p>You can send me feedback or questions</p><p>If a feature turns out to be unclear, that means I either have to add better documentation for it or revise the feature itself.</p><p>(I‚Äôm writing a guide book in parallel to development, <a href="https://schichler.dev/Asteracea/">deployed automatically</a> from and tested against <em>develop</em>. The ‚ÄúIntroduction‚Äù page is a bit outdated; I‚Äôll get around to updating it eventually.)</p><li><p>You can contribute code to related repositories</p><p>The main Asteracea repository is too in flux right now to efficiently take contributions, but there are a number of dependencies that have a stable API but are internally not optimised well or incomplete.</p><p>These crates, for example <em>tiptoe</em>, also mostly have a generic API rather than one designed only for Asteracea, so they may be worth a look for your own projects too.</p></ul><p>I‚Äôm not currently in a position where I could invest small monetary contributions efficiently to further Asteracea‚Äôs development. (The most direct effect would be letting me eat better and showing me that there‚Äôs tangible interest in this side project of mine, which <strong>may</strong> lead to me spending more time on it and coding a bit faster.)</p><p>If you‚Äôd like to tip me regardless, for example for this blog post here, I now have <a href="https://ko-fi.com/tamme">Ko-fi</a> and <a href="https://github.com/sponsors/Tamschi">GitHub Sponsors</a> profiles. If you happen to use RPG Maker MV, you can also have a look at <a href="https://tamschi.itch.io/">my Itch.io page</a> where I published some tools and plugins.</p><p>For anything else, you can reach me at the email address available from the sidebar.</p><h2 id="project-repositories">Project repositories<a href="#project-repositories" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="table-wrapper"><table><thead><tr><th>¬†<th>¬†<tbody><tr><td><a href="https://github.com/Tamschi/Asteracea">Asteracea</a><td>Component macro DSL and beginnings of a standard library.<tr><td><a href="https://github.com/Tamschi/lignin">lignin</a><td>VDOM and callbacks.<tr><td><a href="https://github.com/Tamschi/lignin-schema">lignin-schema</a><td>Declarative (superficial) HTML, SVG and MathML schema, encoded in Rust‚Äôs type system.<br />The name is something of a hold-over; there is no dependency relationship with <code class="language-plaintext highlighter-rouge">lignin</code> anymore.<tr><td><a href="https://github.com/Tamschi/lignin-html">lignin-html</a><td>(Partially-validating) VDOM-to-HTML renderer.<tr><td><a href="https://github.com/Tamschi/lignin-dom">lignin-dom</a><td>DOM hydration and diffing.<tr><td><a href="https://github.com/Tamschi/rhizome">rhizome</a><td>A lightweight runtime dependency injection container/reference-counted context tree.<tr><td><a href="https://github.com/Tamschi/fruit-salad">fruit-salad</a><td>Trait object downcasts, among other features. Used by rhizome.<tr><td><a href="https://github.com/Tamschi/pinus">pinus</a><td>Value-pinning B-tree maps that can be added to through shared references. Used by rhizome.<tr><td><a href="https://github.com/Tamschi/tiptoe">tiptoe</a><td><a href="https://blog.schichler.dev/posts/Intrusive-Smart-Pointers-+-Heap-Only-Types-=/">Intrusively reference-counting smart pointers.</a> Used by rhizome.</table></div><h2 id="additional-repositories">Additional repositories<a href="#additional-repositories" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="table-wrapper"><table><thead><tr><th>¬†<th>¬†<tbody><tr><td><a href="https://github.com/Tamschi/lignin-azul">lignin-azul</a>,<br /> and <a href="https://github.com/Tamschi/asteracea-native-windows-gui">asteracea-native-windows-gui</a> and<br /> <a href="https://github.com/Tamschi/lignin-native-windows-gui">lignin-native-windows-gui</a><td>Sketches/proofs of concept for using Asteracea to implement native GUIs.<br /> In practice, it might be a good idea to make <code class="language-plaintext highlighter-rouge">lignin</code>‚Äôs VDOM nodes generic<br /> over the element type type, to allow switching the <code class="language-plaintext highlighter-rouge">&amp;str</code>s for an <code class="language-plaintext highlighter-rouge">enum</code>.<tr><td><a href="https://github.com/Tamschi/an-asteracea-app">an-asteracea-app</a><td>WIP single page application demo project. Very rough, somewhat outdated,<br /> but <a href="https://github.com/Tamschi/an-asteracea-app/blob/0b00d0613aa9ad594cf4454cc090cd67e9273aa0/src/lib.rs#L69-L90">shows the rotating VDOM buffers</a>.</table></div><h2 id="footnotes">Footnotes<a href="#footnotes" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="-suspense">¬π Suspense<a href="#-suspense" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>This is the source code for the suspense component in its entirety:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="k">crate</span><span class="p">::{</span>
  <span class="nn">include</span><span class="p">::{</span>
    <span class="nn">async_</span><span class="p">::{</span><span class="n">AsyncContent</span><span class="p">,</span> <span class="n">ContentSubscription</span><span class="p">,</span> <span class="n">Synchronized</span><span class="p">},</span>
    <span class="nn">render_callback</span><span class="p">::</span><span class="n">RenderOnce</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nn">services</span><span class="p">::{</span><span class="n">ContentRuntime</span><span class="p">,</span> <span class="n">Invalidator</span><span class="p">},</span>
  <span class="nn">__</span><span class="p">::</span><span class="n">Built</span><span class="p">,</span>
<span class="p">};</span>
<span class="k">use</span> <span class="nn">lignin</span><span class="p">::{</span><span class="n">Guard</span><span class="p">,</span> <span class="n">ThreadSafety</span><span class="p">};</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">cell</span><span class="p">::</span><span class="n">UnsafeCell</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">typed_builder</span><span class="p">::</span><span class="n">TypedBuilder</span><span class="p">;</span>

<span class="nd">#[derive(TypedBuilder)]</span>
<span class="k">pub</span> <span class="k">struct</span> <span class="n">NoParentParameters</span> <span class="p">{}</span>
<span class="k">impl</span> <span class="n">Built</span> <span class="k">for</span> <span class="n">NoParentParameters</span> <span class="p">{</span>
  <span class="k">type</span> <span class="n">Builder</span> <span class="o">=</span> <span class="n">NoParentParametersBuilder</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="k">fn</span> <span class="nf">builder</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="k">Self</span><span class="p">::</span><span class="n">Builder</span> <span class="p">{</span>
    <span class="k">Self</span><span class="p">::</span><span class="nf">builder</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nn">asteracea</span><span class="p">::</span><span class="nd">component!</span> <span class="p">{</span>
  <span class="cd">/// Renders `'spinner` unless `'ready` has finished construction.</span>
  <span class="cd">///</span>
  <span class="cd">/// `'ready`'s construction is scheduled automatically.</span>
  <span class="k">pub</span> <span class="nf">Suspense</span><span class="p">(</span>
    <span class="k">priv</span> <span class="k">dyn</span> <span class="n">runtime</span><span class="p">:</span> <span class="k">dyn</span> <span class="n">ContentRuntime</span><span class="p">,</span>
    <span class="k">priv</span> <span class="k">dyn</span> <span class="n">invalidator</span><span class="o">?</span><span class="p">:</span> <span class="k">dyn</span> <span class="n">Invalidator</span><span class="p">,</span>
  <span class="p">)</span><span class="o">&lt;</span><span class="n">S</span><span class="p">:</span> <span class="nv">'bump</span> <span class="o">+</span> <span class="n">ThreadSafety</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="c1">// Clearly missing syntactic sugar for these transclusion slots:</span>
    <span class="n">spinner</span><span class="p">:</span> <span class="p">(</span><span class="n">NoParentParameters</span><span class="p">,</span> <span class="nb">Box</span><span class="o">&lt;</span><span class="n">RenderOnce</span><span class="o">&lt;</span><span class="nv">'_</span><span class="p">,</span> <span class="nv">'bump</span><span class="p">,</span> <span class="n">S</span><span class="o">&gt;&gt;</span><span class="p">),</span>
    <span class="k">mut</span> <span class="n">ready</span><span class="p">:</span> <span class="p">(</span><span class="n">NoParentParameters</span><span class="p">,</span> <span class="n">AsyncContent</span><span class="o">&lt;</span><span class="nv">'_</span><span class="p">,</span> <span class="n">RenderOnce</span><span class="o">&lt;</span><span class="nv">'_</span><span class="p">,</span> <span class="nv">'bump</span><span class="p">,</span> <span class="n">S</span><span class="o">&gt;&gt;</span><span class="p">),</span>
  <span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">Guard</span><span class="p">::</span><span class="o">&lt;</span><span class="nv">'bump</span><span class="p">,</span> <span class="n">S</span><span class="o">&gt;</span>

  <span class="c1">// Cancels on drop via strong/weak `Arc` reference counting.</span>
  <span class="k">let</span> <span class="k">self</span><span class="py">.subscription</span> <span class="o">=</span> <span class="nn">UnsafeCell</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">ContentSubscription</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="nb">None</span><span class="p">);</span>

  <span class="p">{</span>
    <span class="k">match</span> <span class="n">ready</span><span class="na">.1</span><span class="nf">.synchronize</span><span class="p">(</span><span class="k">unsafe</span><span class="p">{</span><span class="o">&amp;</span><span class="k">mut</span> <span class="o">*</span><span class="k">self</span><span class="py">.subscription</span><span class="nf">.get</span><span class="p">()})</span> <span class="p">{</span>
      <span class="nn">Synchronized</span><span class="p">::</span><span class="n">Unchanged</span> <span class="k">=&gt;</span> <span class="p">(),</span>
      <span class="nn">Synchronized</span><span class="p">::</span><span class="nf">Reset</span><span class="p">(</span><span class="n">future</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="k">self</span><span class="py">.runtime</span><span class="nf">.start_content_future</span><span class="p">(</span><span class="n">future</span><span class="p">,</span> <span class="k">self</span><span class="py">.invalidator</span><span class="nf">.clone</span><span class="p">()),</span>
    <span class="p">}</span>

    <span class="n">ready</span><span class="na">.1</span><span class="nf">.render</span><span class="p">(</span><span class="n">bump</span><span class="p">)</span><span class="nf">.unwrap_or_else</span><span class="p">(||</span> <span class="p">(</span><span class="n">spinner</span><span class="na">.1</span><span class="p">)(</span><span class="n">bump</span><span class="p">))</span><span class="o">?</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>As you can see, it‚Äôs quite concise already, and only generic over the thread-safety of the resulting VDOM.</p><p>The part of the body wrapped in <code class="language-plaintext highlighter-rouge">{}</code> is plain Rust, as there is not much state management to be done here and the transcluded content already generates the finished drop-guarded VDOM handles. I plan to make the syntax for Rust blocks more explicit as I continue to move to brace-bodied flow control expressions.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/rust/'>Rust</a>, <a href='/categories/asteracea/'>Asteracea</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a> <a href="/tags/frontend/" class="post-tag no-text-decoration" >frontend</a> <a href="/tags/components/" class="post-tag no-text-decoration" >components</a> <a href="/tags/dsl/" class="post-tag no-text-decoration" >DSL</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper">This post is <a href="https://creativecommonsusa.org/wp-content/uploads/2018/01/Copyright-and-Open-Licensing-Primer.pdf">not licensed</a> for any purpose, unless otherwise noted.<br> It is provided AS IS without any guarantee of correctness beyond those required for legal reasons.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Asteracea (as of right now) üåº - Abstraction Haven&url=https://blog.schichler.dev/posts/Asteracea/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Asteracea (as of right now) üåº - Abstraction Haven&u=https://blog.schichler.dev/posts/Asteracea/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Asteracea (as of right now) üåº - Abstraction Haven&url=https://blog.schichler.dev/posts/Asteracea/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Asteracea/">Asteracea (as of right now) üåº</a><li><a href="/posts/Moving/">Moving</a><li><a href="/posts/Some-thoughts-on-Bubble/">Some thoughts on Bubble</a><li><a href="/posts/Cheese-olive-dish/">Cheese-olive dish</a><li><a href="/posts/Intrusive-Smart-Pointers-+-Heap-Only-Types-=/">Intrusive Smart Pointers + Heap Only Types = üíû</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/patterns/">patterns</a> <a class="post-tag" href="/tags/walkthrough/">walkthrough</a> <a class="post-tag" href="/tags/cheese/">cheese</a> <a class="post-tag" href="/tags/chili/">chili</a> <a class="post-tag" href="/tags/components/">components</a> <a class="post-tag" href="/tags/composition/">composition</a> <a class="post-tag" href="/tags/crate-included/">crate included</a> <a class="post-tag" href="/tags/critique/">critique</a> <a class="post-tag" href="/tags/docker/">Docker</a></div></div></div><script src="/assets/un-cdn/jsdelivr/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Semantic-FFI-Bindings-in-Rust-Reactivating-the-Borrow-Checker/"><div class="card-body"> <em class="timeago small" date="2020-10-31 16:10:00 +0100" >Oct 31, 2020</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Semantic FFI Bindings in Rust - Reactivating the Borrow Checker</h3><div class="text-muted small"><p> In this post: Rust references, opaque handles and ownership Likely pitfalls or: c_void isn‚Äôt (yet) C‚Äôs void One big caveat Lifetime-generic opaque references and callbacks ...</p></div></div></a></div><div class="card"> <a href="/posts/Intrusive-Smart-Pointers-+-Heap-Only-Types-=/"><div class="card-body"> <em class="timeago small" date="2021-11-14 18:44:00 +0100" >Nov 14, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Intrusive Smart Pointers + Heap Only Types = üíû</h3><div class="text-muted small"><p> In this post: Heap only types: Where do they appear? Handling heap only types: Box, Rc and Arc Cloning a handle from a heap-only borrow? (Yes, but‚Ä¶) Can this be more idiomati...</p></div></div></a></div><div class="card"> <a href="/posts/Pinning-in-plain-English/"><div class="card-body"> <em class="timeago small" date="2021-11-24 17:10:00 +0100" >Nov 24, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Pinning in plain English</h3><div class="text-muted small"><p> A mirrored bell pepper is still clearly the same fruit, but the mirror image, if physically placed outside the mirror, would largely only be compatible with a fundamentally different biology, ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Moving/" class="btn btn-outline-primary" prompt="Older"><p>Moving</p></a> <a href="/posts/Rust-RFC-3634_-Scoped-impl-Trait-for-Type/" class="btn btn-outline-primary" prompt="Newer"><p>Rust RFC 3634: Scoped <code>impl Trait for Type</code></p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> ¬© 2024 <a href="https://schichler.dev/">Tamme Schichler</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are not licensed for redistribution by the author. (Feel free to save a copy for personal use, though. You likely don't even need permission for that.)">Most rights reserved.</span> <br> <a href="https://impressum.schichler.dev/">Impressum/Imprint, Datenschutz</a></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/patterns/">patterns</a> <a class="post-tag" href="/tags/walkthrough/">walkthrough</a> <a class="post-tag" href="/tags/cheese/">cheese</a> <a class="post-tag" href="/tags/chili/">chili</a> <a class="post-tag" href="/tags/components/">components</a> <a class="post-tag" href="/tags/composition/">composition</a> <a class="post-tag" href="/tags/crate-included/">crate included</a> <a class="post-tag" href="/tags/critique/">critique</a> <a class="post-tag" href="/tags/docker/">Docker</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="/assets/un-cdn/jsdelivr/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="/assets/un-cdn/jsdelivr/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="/assets/un-cdn/jsdelivr/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script>
